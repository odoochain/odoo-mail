define(["common/csharp-to-js-glue","jquery-plugins/smartpaginator","common/common"],function(e,t,n){var r=e.values("indexconfig"),i=e.values("rightconfig");window.Editor4NewsletterPreview={ShowFilterPreview:function(){var e=$("#preview-show-all-boxs").is(":visible"),t=$("#preview-use-filter-box").is(":visible");if(e){Editor4NewsletterPreview.FilterList(e,t);return}if(!t)return;Editor4NewsletterPreview.FilterList(e,t)},FilterList:function(){var e=[];$("input[class=show-filter]:checked").each(function(){e.push($(this).val())});var t=$("#preview-content").find($("div[class^='SF']")).length>0?$("#preview-content").find($("div[class^='SF']")):$("#preview-content iframe").contents().find("div[class^='SF']");t.each(function(){if(e.length>0){var t=$(this).attr("class").split("_")[0].replace("SF","");$.inArray(t,e)>-1?$(this).show():$(this).hide()}else $(this).hide()})},PreviewShowAll:function(){$("#preview-use-filter-box").hide(),$("#preview-simulate-subscriber-box").hide(),$("#preview-show-html-box").hide(),$("#preview-show-PermaLink-box").hide(),$("#preview-ruler-types").length!=0&&$("#preview-content-background").attr("class","preview-content-background"),Editor4NewsletterPreview.AddPreviewIFrames()},PreviewUseFilter:function(){$("#preview-use-filter-box").show(),$("#preview-simulate-subscriber-box").hide(),$("#preview-show-html-box").hide(),$("#preview-show-PermaLink-box").hide(),$("#preview-content-background").attr("class","preview-content-background-blank"),$("input[class=show-filter]:checked").each(function(){$(this).attr("checked",!1)}),Editor4NewsletterPreview.AddPreviewIFrames(),$("#preview-content iframe:visible").length<=0&&Editor4NewsletterPreview.ShowFilterPreview()},PreviewSimulateSubscriber:function(){$("#preview-use-filter-box").hide(),$("#preview-simulate-subscriber-box").show(),$("#preview-show-html-box").hide(),$("#preview-show-PermaLink-box").hide(),$("#preview-content-background").attr("class","preview-content-background-blank"),$("#subscriber-mailing-list").trigger("change"),Editor4NewsletterPreview.AddPreviewIFrames()},PreviewShowHtml:function(){$("#preview-use-filter-box").hide(),$("#preview-simulate-subscriber-box").hide(),$("#preview-show-PermaLink-box").hide(),$("#preview-show-html-box").show(),$("#preview-content-background").attr("class","preview-content-background-blank"),Editor4NewsletterPreview.AddPreviewIFrames()},PreviewShowPermaLink:function(){$("#preview-use-filter-box").hide(),$("#preview-simulate-subscriber-box").hide(),$("#preview-show-html-box").hide(),$("#preview-show-PermaLink-box").show(),$("#preview-content-background").attr("class","preview-content-background-blank"),$("#preview-content-background").append('\n<div id="preview-PermaLink-content"></div>'),Editor4NewsletterPreview.AddPreviewIFrames()},ShowMobileOverlay:function(){$("#preview-content-background").append('\n<div id="preview-overlay-mobile"></div>');var e=$("#preview-content-background").css("height");$("#preview-overlay-mobile").css("height",e)},HideMobileOverlay:function(){delay(500),$("#preview-overlay-mobile").remove()},ShowPreviewOverlay:function(){$("#preview-content-background").append('\n<div id="preview-overlay-preview"></div>');var e=$("#preview-content-background").css("height");$("#preview-overlay-preview").css("height",e)},HidePreviewOverlay:function(){delay(500),$("#preview-overlay-preview").remove()},ShowOutlookOverlay:function(){$("#preview-content-background").append('\n<div id="preview-overlay-outlook"></div>');var e=$("#preview-content-background").css("height");$("#preview-overlay-outlook").css("height",e)},HideOutlookOverlay:function(){delay(500),$("#preview-overlay-outlook").remove()},ShowFoldOverlay:function(){$("#preview-content-background").append('\n<div id="preview-overlay-fold"></div>');var e=$("#preview-content-background").css("height");$("#preview-overlay-fold").css("height",e)},HideFoldOverlay:function(){delay(500),$("#preview-overlay-fold").remove()},PreviewRecipients:null,GetPreviewRecipients:function(){var e=Editor4NewsletterPreview.GetSelectedMailingListId();e!=null&&$.ajax({type:"POST",url:i().getPreviewRecipients,data:{id:e,pageNr:0},dataType:"html",success:function(e){Editor4NewsletterPreview.PreviewRecipients=JSON.parse(e),Editor4NewsletterPreview.DisplayPreviewRecipients()},error:function(e){n.defaultErrorCallback(e)}})},DisplayPreviewRecipients:function(){$("#subscriber-list").empty();var e=Editor4NewsletterPreview.PreviewRecipients;$("#all-subscribers-count").val(e.AllRecipientsOnListCount),$("#subscribers-selected-page").val(e.PageNumber);var t=Editor4NewsletterPreview.GetSelectedField1(),n=Editor4NewsletterPreview.GetSelectedField2(),r=Editor4NewsletterPreview.GetSelectedField3();$.each(e.Recipients,function(e,i){var s="";s+=Editor4NewsletterPreview.GetRecipientNamePart(i,t)+" | ",s+=Editor4NewsletterPreview.GetRecipientNamePart(i,n)+" | ",s+=Editor4NewsletterPreview.GetRecipientNamePart(i,r),$("#subscriber-list").append('<option value="'+i.Id+'">'+s+"</option>")}),Editor4NewsletterPreview.ShowSmartPaginator()},GetRecipientNamePart:function(e,t){var n="";return t.indexOf("dd")==0?n=e.DemographicDataValues[parseInt(t.substr(2,t.length))]:n=e[t],n==null&&(n=""),n},GetSelectedMailingListId:function(){return $("#subscriber-mailing-list option:selected").val()},GetSelectedField1:function(){return $("#subscriber-field1 option:selected").val()},GetSelectedField2:function(){return $("#subscriber-field2 option:selected").val()},GetSelectedField3:function(){return $("#subscriber-field3 option:selected").val()},DisplayTenRandomPreviewRecipients:function(){$.ajax({type:"POST",url:i().getTenRandomPreviewRecipients,dataType:"html",success:function(e){$("#subscriber-mailing-list  option:selected").removeAttr("selected"),Editor4NewsletterPreview.PreviewRecipients=JSON.parse(e),Editor4NewsletterPreview.DisplayPreviewRecipients()},error:function(e){n.defaultErrorCallback(e)}})},GetSelectedSubscriber:function(){return $("#subscriber-list option:selected").val()},DisplaySimulatedPreview:function(){var e=Editor4NewsletterPreview.GetSelectedSubscriber(),t=$("#preview-content iframe:visible").length>0?$("#preview-content-template iframe").contents().find("body"):$("#preview-content-template"),s=$("#preview-content iframe:visible").length>0?$("#preview-content iframe").contents().find("body"):$("#preview-content");$.ajax({type:"POST",url:i().displaySimulatedPreview,data:{id:r().newsletterId,subscriberId:e,bodyHtml:t.html()},mode:"distinctUrlQueue",port:"subscriberPreview",dataType:"html",success:function(e){s.html(e),Editor4NewsletterPreview.ShowSmartPaginator()},error:function(e){e.statusText!="abort"&&n.defaultErrorCallback(e)}})},SmartPaginationOnChange:function(e){var t=Editor4NewsletterPreview.GetSelectedMailingListId();t!=null&&$.ajax({type:"POST",url:i().getPreviewRecipients,data:{id:t,pageNr:e-1},dataType:"html",success:function(e){Editor4NewsletterPreview.PreviewRecipients=JSON.parse(e),Editor4NewsletterPreview.DisplayPreviewRecipients()},error:function(e){n.defaultErrorCallback(e)}})},ShowSmartPaginator:function(){$("#smart-paginator").smartpaginator({totalrecords:$("#all-subscribers-count").val(),recordsperpage:10,length:5,initval:Editor4NewsletterPreview.GetSubscribersSelectedPage(),next:TranslationsEditor.Common.Next,prev:TranslationsEditor.Common.Prev,first:TranslationsEditor.Common.First,last:TranslationsEditor.Common.Last,theme:"smartpaginator",onchange:Editor4NewsletterPreview.SmartPaginationOnChange}),$("#smart-paginator").css("display","block")},GetSubscribersSelectedPage:function(){var e=$("#subscribers-selected-page").val();return e==null&&(e=1),e},SelectAllTextInShowHtml:function(){$("#preview-html-content").select()},ChangePreviewResolution:function(){var e=$(this),t=e.data("previewclass")||"defaultPreviewFrame",n=e.data("previewheight")||-1,r=$(".previewFrame:visible"),i=r.data("previousclass")||"defaultPreviewFrame";if(i==t)return;r.switchClass(i,t,400),r.data("previousclass",t),Editor4NewsletterPreview.ShowPreviewMask(r,n)},ShowPreviewMask:function(e,t){var n=e.siblings(".previewMask"),r=e.height(),i=t>0&&r-t>0?t:r,s=t>0&&r-t>0?r-t:0;n.css("margin-top")=="9999px"&&n.css({"margin-top":r+"px",height:"0px"}),n.animate({"margin-top":i+"px",height:s+"px"},400)},RemoveDeviceMediaQueryTags:function(e){$.each(e.contents().find("style"),function(e,t){$(t).html($(t).html().replace(/(@media[^{]*)\(max-device-width\: (\d*)px\)/gi,"$1(max-width: $2px)").replace(/(@media[^{]*)\(min-device-width\: (\d*)px\)/gi,"$1(min-width: $2px)"))})},AdjustPreviewFrameHeight:function(e){e.style.height=e.contentDocument.body.scrollHeight+"px"},AddPreviewIFrames:function(){$("iframe.previewFrame").remove(),$(".previewMask").after('<iframe class="previewFrame defaultPreviewFrame" ></iframe>'),$.each($(".previewFrame"),function(e,t){$(t).attr("src",$(".previewMask").first().data("sourceurl")),$(t).load(function(){Editor4NewsletterPreview.RemoveDeviceMediaQueryTags($(t)),Editor4NewsletterPreview.ShowFilterPreview(),Editor4NewsletterPreview.CheckAndCleanAddWishImage(),Editor4NewsletterPreview.AdjustPreviewFrameHeight(this)})}),Editor4NewsletterPreview.CheckForLegacyContainer()},CheckForLegacyContainer:function(){if($("#preview-content iframe:visible").length>0)return;$("#preview-content div[class^='SF']").show()},CheckAndCleanAddWishImage:function(){$(".previewFrame").contents().find('img[src^="'+r().addWishImageRedirectUrl+'"]').each(function(){$(this).attr("src",$(this).attr("src").replace(/#/g,""))})}}});