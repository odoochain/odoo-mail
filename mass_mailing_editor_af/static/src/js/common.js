define("common/common",["common/widgets/popup","common/modules/underscore"],function(e,t){var n,r={},i={modalMessage:t.template('<div id="modal-message">{{message}}</div>')};return window.Apsis={ANP:{EventFunctions:{},SurveyFunctions:{},TriggerFunctions:{},WebServices:{},registerNamespace:function(e){var t=e.split("."),n=ANP,r;t[0]==="ANP"&&(t=t.slice(1));for(r=0;r<t.length;r+=1)typeof (n[t[r]]==="undefined")&&(n[t[r]]={}),n=n[t[r]];return n}}},window.lastImage=[],getRegexResult=function(e){var t=e.exec(location.href);return t?t[1]:""},n=Apsis.ANP.CommonFunctions={webServices:{OVERVIEW:"event/EventOverviewService",SETTINGS:"event/EventSettingsService",SESSION:"event/EventSessionService",PARTICIPANT:"event/EventParticipantService",GENERAL:"event/EventGeneralService",FORM:"event/FormService",IMAGEGALLERY:"imagegallery/ImageGalleryService",IMAGEGALLERYUPLOAD:"imagegallery/ImageGalleryUploadService",IMAGEGALLERYPERMISSION:"imagegallery/ImageGalleryPermissionService",IMAGEGALLERYMIGRATIONSERVICE:"imagegallery/ImageGalleryMigrationService",IMAGEGALLERYIMAGEMANIPULATION:"imagegallery/ImageGalleryImageManipulation",SOCIALMEDIA:"event/EventSocialMediaService",ACTION:"SurveyActionService",ALTERNATIVE:"SurveyAlternativeService",BRANCHING:"SurveyBranchingService",CONDITION:"SurveyConditionService",INVITATION:"SurveyInvitationService",ITEM:"SurveyItemService",PAGE:"SurveyPageService",REPORTCHART:"SurveyReportChartService",REPORTPAGE:"SurveyReportPageService",REPORT:"SurveyReportService",RESPONSE:"SurveyResponseService",SURVEY:"SurveyService",STYLE:"SurveyStyleService",TEMPLATE:"SurveyTemplateService",TRANSLATION:"SurveyTranslationService",TRIGGEROVERVIEW:"trigger/TriggerOverviewService",TRIGGERSETTINGS:"trigger/TriggerSettingsService",TRIGGERREPORT:"trigger/TriggerReportService",RECIPIENTACTIVITY:"Recipient/RecipientActivityService"},loadStylesheet:function(e){var t=document.createElement("link");t.type="text/css",t.rel="stylesheet",t.href=n.anpRoot+"/static/css/"+e+"?"+window.cacheBust,document.getElementsByTagName("head")[0].appendChild(t)},_loadingModal:function(){e.show({html:'<div id="loading-modal" style="text-align:center;">Loading</div>',title:"Status",width:"small",buttons:{}})},_validateDigitInput:function(){var e=/[^\d]/;e.test(jQuery(this).val())&&(alert("Digits only"),jQuery(this).val("0"))},_closeLoadingModal:function(e){e=e||{},e.hasOwnProperty("closeOnlyTopmost")||(e.closeOnlyTopmost=!1),e.closeOnlyTopmost?($(".ui-widget-overlay").last().remove(),$(".ui-dialog").last().remove()):($(".ui-widget-overlay").remove(),$(".ui-dialog").remove())},disableSubmitOnForms:function(){$(".disable_submit").submit(function(){return!1})},defaultErrorCallback:function(e){function t(){location.reload()}if(e._statusCode===0)return;if(e._statusCode===401||e.status===401)t();else{var n="Internal error occurred. Please contact Apsis support if this continues to persist. Backtrace: <code>"+e._message+"</code>",r="Status "+e._statusCode,i={Reload:t};require(["common/widgets"],function(e){e.message(n,{title:r,buttons:i,width:"small"})})}},invokeNativeMethod:function(e,t,r){if(typeof e[t]=="undefined")throw new Error("Tried to invoke non-existing web service method: '"+t+"' from '"+e.__typeName+"'");typeof r[r.length-1]=="function"&&typeof r[r.length]!="function"&&r.push(n.defaultErrorCallback),e[t].apply(e,r)},invokeDependencyBinds:function(e,t){var n,r;for(n=0;n<t.length;n++)r=t[n],r&&typeof r.setupDocument=="function"&&t[n].setupDocument(e)},invokeMethod:function(e,t){var i=Array.prototype.slice.apply(arguments),s=n.webServices[e]||"",o;i=i.splice(2,i.length),o=s.split("/")[1]||s;if(o==="")throw new Error("No service named '"+e+"' found.");if(typeof t=="undefined")throw new Error("No method to invoke.");typeof Apsis.ANP.WebServices[o]=="undefined"?r[o]?r[o].push({method:t,args:i}):(r[o]=[{method:t,args:i}],$.getScript(n.anpRoot+"/webservices/"+s+".asmx/js",function(){var e=0,t;for(;e<r[o].length;e++)t=r[o][e],n.invokeNativeMethod(Apsis.ANP.WebServices[o],t.method,t.args)})):n.invokeNativeMethod(Apsis.ANP.WebServices[o],t,i)},eventId:getRegexResult(/(?:Form\.aspx.*EventId=|Id=)([a-zA-Z0-9]+)/i),eventSessionId:getRegexResult(/SessionId=([a-zA-Z0-9]+)/i),surveyId:getRegexResult(/Id=([a-zA-Z0-9]+)/i),triggerId:getRegexResult(/Id=([a-zA-Z0-9]+)/i),reportId:getRegexResult(/ReportId=([a-zA-Z0-9]+)/i),anpRoot:getRegexResult(/(\/anp(v)?3web[\w*\-\.]*)/i),pageName:getRegexResult(/\/(\w+).aspx.*/i).toLowerCase(),defaultLanguage:function(){return parseFloat(jQuery("#default-language").val())}(),newSurveySwitchAlert:function(e){if(n.surveyId===""){if(n.pageName==="settings")return!1;location.href="Settings.aspx"}},compressStr:function(e){return e.replace(/\t+|\s+/g," ").replace(/\r\n|\n|\r/g,"")},calculateDate:function(e){var t=jQuery(e+"-date").val(),n=jQuery(e+"-hour").val(),r=jQuery(e+"-min").val();return(t===""?"1970-01-01":t)+" "+n+":"+r},closeAllDialogs:function(){jQuery(".ui-dialog-content").dialog("destroy").remove()},itemTypes:{Textbox:0,Textarea:1,Checkbox:2,Radiobutton:3,Dropdown:4,MatrixRadiobutton:5,MatrixCheckbox:6,MatrixTextbox:7,Scale:8,Heading:9,Description:10,Comment:11,HTMLCode:12,Link:13,Image:14,Space:15},triggerModuleType:{SendEmail:0,SendSms:1,EditList:2,SetData:3,SendToOne:4},FixIENewLines:function(e){return parseInt($.browser.version,10)<9?e.replace(/\n/g,""):e},HtmlDecode:function(e){var t=e;return Encoder.hasEncoded(e)&&(t=Encoder.htmlDecode(e)),t},HtmlEncode:function(e){return Encoder.htmlEncode(e)},ReplaceNewlinesWithBrakelines:function(e){return e==undefined?e:e.replace(/\n/g,"<br/>")},ReplaceBreakelinesWithNewlines:function(e){return e==undefined?e:(e=e.replace(/\n/g,""),e.replace(/(\<br\>|(\<br\/\>))/gi,"\n"))},ensureDigitInput:function(e){if(e.which)var t=e.which;else{if(!Event)return!0;var t=Event.keyCode}return!(t>31&&(t<48||t>57))},validateCommaSeparatedEmails:function(e){var n=!0;return t.forEach(e.split(","),function(e){var t=$.trim(e),r=/^([a-zA-Z0-9_\-\+\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([a-zA-Z0-9\-]+\.)+))([a-zA-Z]{2,10}|[0-9]{1,3})(\]?)$/gi;r.exec(t)==null&&(n=!1)}),n},disableContainedLinks:function(e){$(e).addClass("ui-state-disabled"),$(e).each(function(e,t){$(t).delegate("a","click",n.returnFalse)})},enableContainedLinks:function(e){$(e).removeClass("ui-state-disabled"),$(e).each(function(e,t){$(t).undelegate("a","click",n.returnFalse)})},returnFalse:function(){return!1},displayMessageAndRedirect:function(e,t,n){function r(){location.href=e}if(!e||!t||!n)return;require(["common/widgets"],function(e){e.message(n,{title:t,onClose:r})})}},n});