<odoo>
  <data>
    <record model="ir.ui.view" id="view_mail_mass_mailing_form">
      <field name="name">mail.mass_mailing.form</field>
      <field name="model">mail.mass_mailing</field>
      <field name="inherit_id" ref="mass_mailing.view_mail_mass_mailing_form"/>
      <field name="arch" type="xml">
	<xpath expr="//notebook" position="inside">
	  <page string="Campain Flow" name="campain_flow">
	    <field name="mailing_activity_ids" widget="section_and_note_one2many" mode="tree,form">
              <form>
		<sheet>
		  <div class="oe_title">
		    <label for="name" class="oe_edit_only" string="Name"/>
		    <h1><field name="name" required="1" placeholder="e.g. eCommerce Offers"/></h1>
		  </div>
		  <group>
		    <group>
                      <field name="activity_type" widget="radio" options="{'horizontal': true}"/>
		      <!-- FIX ME! (Context) -->
                      <field name="mass_mailing_id"
			     domain="[('mailing_model_id', '=', model_id), ('use_in_marketing_automation', '=', True)]"
			     context="{'default_state': 'done',
				      'default_mailing_model_id': model_id,
				      'default_use_in_marketing_automation': True,
				      'form_view_ref': 'autoresponder.mass_mailing_view_form_marketing_activity'}"
			     attrs="{'required': [('activity_type', '=', 'email')],
				    'invisible': [('activity_type', '!=', 'email')]}"/>
                      <field name="server_action_id"
			     domain="[('model_id', '=', model_id)]"
			     attrs="{'required': [('activity_type', '=', 'action')], 'invisible': [('activity_type', '!=', 'action')]}"
			     context="{'default_model_id': model_id}"/>
                      <field name="statistics_graph_data" invisible="1"/>
		    </group>
		    <group>
                      <label for="interval_number" string="Perform"/>
                      <div>
			<field name="interval_number" class="oe_inline"/>
			<field name="interval_type" class="oe_inline ml4"/>
			<span class="ml8">after</span>
                      </div>
                      <label for="trigger_type" class="d-none"/>
                      <div>
			<field name="trigger_type"/>
                      </div>
                      <label for="parent_id" attrs="{'invisible': [('trigger_type', '=', 'begin')]}"/>
                      <div>
			<field name="parent_id"
			       domain="[('id', 'in', parent.mailing_activity_ids), ('id', '!=', id)]"
			       attrs="{'required': [('trigger_type', '!=', 'begin')], 'invisible': [('trigger_type', '=', 'begin')]}"
			       options="{'no_create_edit': True}"/>
                      </div>
                      <span class="o_form_label" invisible="1">Warning</span>
                      <div>
			<small class="oe_edit_only text-muted" attrs="{'invisible': [('trigger_type', '=', 'begin')]}">(save the campaign to make its activities selectable)</small>
                      </div>
                      <label for="validity_duration"/>
                      <div>
			<field name="validity_duration"/>
                      </div>
                      <label for="validity_duration_number" string="Valid during" attrs="{'invisible': [('validity_duration', '=', False)]}"/>
                      <div attrs="{'invisible': [('validity_duration', '=', False)]}">
			<field name="validity_duration_number" class="oe_inline"/>
			<field name="validity_duration_type" class="oe_inline"/>
                      </div>
                      <field name="model_id" invisible="1"/>
                      <field name="model_name" invisible="1"/>
		    </group>
		  </group>
		  <notebook>
		    <page string="Domain">
                      <group>
			<field name="domain" widget="domain" nolabel="1" options="{'in_dialog': True, 'model': 'model_name'}"/>
                      </group>
		    </page>
		  </notebook>
		</sheet>
              </form>
              <tree>
		<field name="interval_standardized" invisible="1"/>
		<field name="id"/>
		<field name="model_name"/>
		<field name="name"/>
		<field name="domain"/>
		<field name="activity_type"/>
		<field name="parent_id"/>
		<field name="trigger_type"/>
		<field name="total_sent"/>
		<field name="total_click"/>
		<field name="total_open"/>
		<field name="total_reply"/>
		<field name="total_bounce"/>
		<field name="processed"/>
		<field name="rejected"/>
              </tree>
	    </field>
	  </page>
	</xpath>
      </field>
    </record>
  </data>
</odoo>
